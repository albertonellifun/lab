<!DOCTYPE html>
<html lang="it">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, maximum-scale=1.0">
		<title>Generatore Felino SVG di Rocky Graffietto</title>
		<style>
			body { font-family: Arial, sans-serif; padding: 20px; background:#eee; overflow-x: hidden; }
			h2 { color:#333; }
			.controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
			select, button { font-size:16px; padding:6px 12px; border-radius:8px; border:1px solid #ccc; margin-bottom: 8px; }
			.svg-container { touch-action: none; filter: drop-shadow(6px 4px 8px #aaa); }
			/* MOBILE FIX */
			@media (max-width: 768px) {
				body { font-size: 20px; padding: 12px; }
				h2 { font-size: 24px; line-height: 1.3; }
				label { font-size: 20px; line-height: 2; }
				p { font-size: 20px; line-height: 1.5; }
				input[type="checkbox"] { transform: scale(1.3); margin-right: 6px; }
				select, button { font-size: 20px; padding: 10px 12px; }
				.group { width: 100%; }
				.card { font-size: 20px; min-width: 100%; padding: 14px; }
				.cards { justify-content: center; }
				table { font-size: 20px; }
				th, td { padding: 10px 6px; }
				.modal-content { margin: 15% auto; font-size: 20px; }
			}
		</style>
	</head>
	<body>
		<h2>Generatore Felino SVG di Rocky Graffietto ü•äüê±</h2>
		<div class="controls">
			<select id="f_redblack">
				<option value="o_o">Nero X·¥∫/X·¥∫ (o/o)</option>
				<option value="O_o">Nero e Rosso X·¥ø/X·¥∫ (O/o)</option>
				<option value="O_O">Rosso X·¥ø/X·¥ø (O/O)</option>
			</select>
			<select id="f_agouti">
				<option value="a_a">No Tabby a/a</option>
				<option value="A_a">Tabby Tigrato A/a</option>
				<option value="A_A">Tabby Tigrato A/A</option>
			</select>
			<select id="f_chocolate">
				<option value="B_B">Nero B/B</option>
				<option value="B_b">Nero portatore B/b</option>
				<option value="b_b">Cioccolato b/b</option>
			</select>
			<select id="f_siamese">
				<option value="C_C">No Siamese</option>
				<option value="C_cs">Portatore</option>
				<option value="cs_cs">Siamese</option>
			</select>
			<select id="f_diluizione">
				<option value="D_D">Colore pieno</option>
				<option value="D_d">Portatore</option>
				<option value="d_d">Diluito</option>
			</select>
			<select id="f_spotted">
				<option value="s_s">No spotting</option>
				<option value="S_s">Spotting medio</option>
				<option value="S_S">Spotting forte</option>
			</select>
			<select id="f_white">
				<option value="w_w">No bianco</option>
				<option value="W_w">Bianco</option>
				<option value="W_W">Bianco totale</option>
			</select>
			<select id="f_hair">
				<option value="L_L">Pelo corto</option>
				<option value="L_l">Portatore</option>
				<option value="l_l">Pelo lungo</option>
			</select>
		</div>
		<hr/>
		<b>Risultato:</b>
		<br/>
		<div class="svg-container">
		<!-- ================= SVG ROCKY ================= -->
		<svg id="catSVG" width="260" height="260" viewBox="0 0 260 260">
			<defs>
				<radialGradient id="headGrad" cx="50%" cy="50%" r="60%">
					<stop offset="0%" stop-color="#322"/>
					<stop offset="100%" stop-color="#ba9"/>
				</radialGradient>
				<radialGradient id="maskGrad" cx="50%" cy="40%" r="70%">
					<stop offset="0%" stop-color="#322"/>
					<stop offset="100%" stop-color="#433"/>
				</radialGradient>
				<radialGradient id="earGrad" cx="50%" cy="30%" r="80%">
					<stop offset="0%" stop-color="#322"/>
					<stop offset="100%" stop-color="#844"/>
				</radialGradient>
				<filter id="shadowBottom" x="-50%" y="-50%" width="200%" height="200%">
					<feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.1)"/>
				</filter>
				<filter id="shadowTop" x="-50%" y="-50%" width="200%" height="200%">
					<feDropShadow dx="0" dy="-2" stdDeviation="2" flood-color="rgba(0,0,0,0.1)"/>
				</filter>
				<!-- occhio giallo/verde per gatti normali -->
				<radialGradient id="irisNormal" cx="50%" cy="50%" r="50%">
					<stop offset="0%" stop-color="#efa"/> <!-- centro chiaro -->
					<stop offset="100%" stop-color="#9b4"/> <!-- bordo scuro -->
				</radialGradient>			
				<!-- occhio azzurro per gatti siamese -->
				<radialGradient id="irisSiamese" cx="50%" cy="50%" r="50%">
					<stop offset="0%" stop-color="#0cf"/> <!-- centro chiaro -->
					<stop offset="100%" stop-color="#0ad"/> <!-- bordo scuro -->
				</radialGradient>
				<!-- occhio arancione per gatti neri -->
				<radialGradient id="irisOrange" cx="50%" cy="50%" r="50%">
					<stop offset="0%" stop-color="#fd7"/> <!-- centro chiaro -->
					<stop offset="100%" stop-color="#f80"/> <!-- bordo scuro -->
				</radialGradient>
				<!-- pelo sfumato -->
				<filter id="blur5" x="-20%" y="-20%" width="200%" height="200%">
					<feGaussianBlur stdDeviation="3" />
				</filter>
			</defs>
			
			<!--coda-->
			<g id="tailGroup">
				<path id="tail" d="M190 225 Q255 205 235 165" stroke="url(#maskGrad)" stroke-width="18" fill="none" stroke-linecap="round" filter="url(#shadowBottom)"/>
				<!-- righe tabby sulla coda -->
				<g id="tailStripes" stroke="#000" stroke-width="5" fill="none" stroke-linecap="round" stroke-opacity="0.15">
					<!-- striscia 1 (vicino alla base della coda) --> 
					<path d="M202 215 Q210 220 210 226"/> 
					<!-- striscia 2 --> 
					<path d="M208 210 Q218 205 230 214"/> 
					<!-- striscia 3 --> 
					<path d="M224 200 Q235 195 243 200"/> 
					<!-- striscia 4 --> 
					<path d="M231 190 Q240 185 246 188"/> 
					<!-- striscia 5 (vicino alla punta) --> 
					<path d="M232 180 Q240 176 246 175"/>
				</g>
			</g>
			<!--corpo-->
			<path id="body" d="M60 205 Q50 245 105 250 L155 250 Q210 245 200 205 Q175 165 130 175 Q85 165 60 205 Z" fill="url(#headGrad)" filter="url(#shadowBottom)"/>
			<!-- pancia bianca -->
			<ellipse id="panzetta"    cx="130" cy="215" rx="20" ry="30" fill="#fff" opacity="0.2" filter="url(#shadowBottom)"/>
			<ellipse id="panzettaBig" cx="130" cy="215" rx="35" ry="30" fill="#fff" opacity="0.0" filter="url(#shadowBottom)"/>
			<!--zampette-->
			<ellipse id="zampetteLeft" cx="105" cy="240" rx="20" ry="12" fill="url(#maskGrad)" filter="url(#shadowTop)"/>
			<ellipse id="zampetteRight" cx="155" cy="240" rx="20" ry="12" fill="url(#maskGrad)" filter="url(#shadowTop)"/>
			<!-- unghiette sx -->
			<g stroke="#ccc" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.5">
			  <path d="M96  240 Q95 245 95 248"/>
			  <path d="M105 240 Q105 246 105 250"/>
			  <path d="M114 240 Q115 245 115 248"/>
			</g>
			<!-- unghiette dx -->
			<g stroke="#ccc" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.5">
			  <path d="M146 240 Q145 245 145 248"/>
			  <path d="M155 240 Q155 246 155 250"/>
			  <path d="M164 240 Q165 245 165 248"/>
			</g>
			
			<!--testa-->
			<ellipse id="head" cx="130" cy="140" rx="95" ry="65" fill="url(#headGrad)" filter="url(#shadowBottom)"/>
			<!--muso-->
			<ellipse cx="130" cy="150" rx="70" ry="45" fill="url(#maskGrad)" filter="url(#shadowBottom)"/>
			
			<!-- TABBY M -->
			<g id="tabbyM" stroke="#000" stroke-opacity="0.15" stroke-width="5" fill="none" stroke-linecap="round">
				<!-- W grande -->
				<!--centro-->
				<path d="M110 105 Q130 90 150 105"/>
				<!--sx-->
				<path d="M110 105 Q100 95 95 85"/>
				<!--dx-->
				<path d="M150 105 Q160 95 165 85"/>
				
				<!-- w interna -->
				<path d="M120 90 Q130 82 140 90"/>
				<path d="M120 90 Q115 85 110 80"/>
				<path d="M140 90 Q145 85 150 80"/>
				
				
				<!-- guancia sinistra -->
				<path d="M70 145 Q90 150 105 160"/>
				<path d="M65 155 Q90 165 110 175"/>
				<!-- guancia destra -->
				<path d="M190 145 Q170 150 155 160"/>
				<path d="M195 155 Q170 165 150 175"/>
			</g>						
			
			<!-- SPOTTING SUL MUSO -->
			<g id="faceSpotting" fill="#fff">
				<!-- blaze centrale -->
				<path id="spotBlaze" d="M130 125
										C120 135 120 155 130 165
										C140 155 140 135 130 125 Z" opacity="0.9"/>
				<!-- mento -->
				<ellipse id="spotChin" cx="130" cy="180" rx="22" ry="15" opacity="0.95"/>
				<!-- mento grande -->
				<ellipse id="spotChinBig" cx="130" cy="183" rx="58" ry="20" opacity="0.95"/>
				<!-- naso grande -->
				<path id="spotBlazeBig" d="M130 125
										C115 125 115 165 130 180
										C145 165 145 125 130 125 Z" opacity="0.9"/>
			</g>
			<!-- orecchie -->
			<!-- orecchie esterne pi√π larghe (Left/Top/center) -->
			<polygon id="earLeft" points="45,120 40,60 105,95" fill="url(#maskGrad)" filter="url(#shadowTop)"/>
			<polygon id="earRight" points="215,120 220,60 155,95" fill="url(#maskGrad)" filter="url(#shadowTop)"/>
			<!-- orecchie interne pi√π larghe -->
			<polygon points="55,115 52,75 90,100" fill="url(#earGrad)"/>
			<polygon points="205,115 208,75 170,100" fill="url(#earGrad)"/>
			
			<!-- occhio sinistro -->
			<ellipse id="eyeLeft" cx="100" cy="135" rx="18" ry="11" fill="#0af" transform="rotate(-15 100 135)"/>
			<ellipse id="pupilLeft" cx="100" cy="135" rx="3" ry="9" fill="#000" transform="rotate(-15 100 135)"/>
			<!-- occhio destro -->
			<ellipse id="eyeRight" cx="160" cy="135" rx="18" ry="11" fill="#0af" transform="rotate(15 160 135)"/>
			<ellipse id="pupilRight" cx="160" cy="135" rx="3" ry="9" fill="#000" transform="rotate(15 160 135)"/>

			<!-- naso/muso -->
			<polygon points="120,165 130,175 140,165" fill="#000"/>
			<!-- bocca -->
			<path d="M130 175 L130 185 
					M130 185 Q120 195 110 185
					M130 183 Q140 195 150 185" stroke="#b98" stroke-width="2" fill="none"/>
			<!-- ==== Baffi 3 per lato ==== -->
			<g id="whiskers" stroke="rgba(200,200,200,0.8)" stroke-width="1" fill="none" filter="url(#shadowBottom)">
				<!-- sinistra -->
				<path d="M118,168 Q70,160 50,170"/>
				<path d="M118,173 Q70,170 50,180"/>
				<path d="M118,178 Q70,180 50,190"/>
				<!-- destra -->
				<path d="M142,168 Q190,160 210,170"/>
				<path d="M142,173 Q190,170 210,180"/>
				<path d="M142,178 Q190,180 210,190"/>
			</g>
		</svg>
		</div>
		<script>
const COLORS = {
	black: "#222222",
	blue: "#6a6a8a",
	chocolate: "#5b3a29",
	lilac: "#b9a3c9",
	red: "#cc4444",
	cream: "#f3c6a5",
	white: "#ffffff",
	tortie: "#444422"
};

//SELECT
const f_redblack = document.getElementById("f_redblack");
const f_chocolate = document.getElementById("f_chocolate");
const f_diluizione = document.getElementById("f_diluizione");
const f_white = document.getElementById("f_white");
const f_siamese = document.getElementById("f_siamese");
const f_spotted = document.getElementById("f_spotted");
const f_hair = document.getElementById("f_hair");

const headGrad = document.getElementById("headGrad");
const maskGrad = document.getElementById("maskGrad");

function setFur(enable) {
	const head = document.getElementById("head");
	const tail = document.getElementById("tail");
	const body = document.getElementById("body");
	const earLeft = document.getElementById("earLeft");
	const earRight = document.getElementById("earRight");
	const zampetteLeft = document.getElementById("zampetteLeft");
	const zampetteRight = document.getElementById("zampetteRight");
	
	setFilter(enable, head);
	setFilter(enable, tail);
	setFilter(enable, body);
	setFilter(enable, earLeft);
	setFilter(enable, earRight);
	setFilter(enable, zampetteLeft);
	setFilter(enable, zampetteRight);
}
function setFilter(enable, cmp) {
	const blur = "url(#blur5)";
	const current = cmp.getAttribute("filter") || "";
	if (enable) {
		if (!current.includes(blur)) {
			cmp.setAttribute( "filter", current ? `${current} ${blur}` : blur );
		}
	} else {
		const updated = current.replace(blur, "").replace(/\s+/g, " ").trim();
		if (updated) {
			cmp.setAttribute("filter", updated);
		} else {
			cmp.removeAttribute("filter");
		}
	}
}


function computeCoatColor() {

	const redblack = f_redblack.value;
	const chocolate = f_chocolate.value;
	const dilution = f_diluizione.value;
	const white = f_white.value;
	const siamese = f_siamese.value;

	/* 1 - WHITE DOMINANTE */
	if (white === "W_W" || white === "W_w") {
		setEyeColor(white === "W_W" ? true : false, false);
		return {
			body: COLORS.white,
			mask: COLORS.white
		};
	}

	let base;

	/* 2 - ROSSO / NERO */
	if (redblack === "O_O") base = "red";
	else if (redblack === "o_o") base = "black";
	else base = "tortie"; // O/o

	/* 3 - CIOCCOLATO (solo se nero) */
	if (base === "black" && chocolate === "b_b") {
		base = "chocolate";
	}

	/* 4 - DILUIZIONE */
	if (dilution === "d_d") {
		if (base === "black") base = "blue";
		else if (base === "chocolate") base = "lilac";
		else if (base === "red") base = "cream";
	}

	/* 5 - SIAMESE = PATTERN */
	if (siamese === "cs_cs") {
		setEyeColor(true, true);
		if (base === "red") {
			// rosso siamese: muso marrone scuro (tipico)
			return {
				body: COLORS.red, // corpo rosso chiaro
				mask: "#733" // muso/mask scuro rosso/marrone
			};
		} else {
			// altri colori
			return {
				body: lighten(COLORS[base], 0.5),
				mask: darken(COLORS[base], 0.4)
			};
		}
	} else {
		setEyeColor(false, false);
	}
	
	return {
		body: COLORS[base],
		mask: COLORS[base]
	};
}

function lighten(hex, f) {
	return shade(hex, 255, f);
}

function darken(hex, f) {
	return shade(hex, 0, f);
}

function shade(hex, target, f) {
	let r = parseInt(hex.substr(1, 2), 16);
	let g = parseInt(hex.substr(3, 2), 16);
	let b = parseInt(hex.substr(5, 2), 16);
	r = Math.round(r + (target - r) * f);
	g = Math.round(g + (target - g) * f);
	b = Math.round(b + (target - b) * f);
	return `rgb(${r},${g},${b})`;
}

const selects = document.querySelectorAll("select");

function updateRocky() {
	const coat = computeCoatColor();
	setGradient(headGrad, coat.body, coat.body);
	setGradient(maskGrad, coat.mask, coat.mask);

	const spotting = f_spotted.value;
	const white = f_white.value;
	const agouti = f_agouti.value;
	const tabbyM = document.getElementById("tabbyM");
	const tailStripes = document.getElementById("tailStripes");
	
	const hasFur = f_hair.value === "l_l";
	setFur(hasFur);

	const faceSpotting = document.getElementById("faceSpotting");
	const blaze = document.getElementById("spotBlaze");
	const blazeBig = document.getElementById("spotBlazeBig");
	const chin = document.getElementById("spotChin");
	const chinBig = document.getElementById("spotChinBig");
	const panzetta = document.getElementById("panzetta");
	const panzettaBig = document.getElementById("panzettaBig");
	
	/* WHITE DOMINANTE ‚Üí tutto bianco */
	if (white === "W_w" || white === "W_W") {
		faceSpotting.style.display = "none";
		//nota: W nasconde anche il tabby!!!
		tabbyM.style.display = "none"; // non tabby
		tailStripes.style.display = "none"; // non tabby
	}
	/* SPOTTING + tabby*/
	else {
		//nota: W nasconde anche il tabby!!!
		if (agouti === "a_a") {
			tabbyM.style.display = "none"; // non tabby
			tailStripes.style.display = "none"; // non tabby
		} else {
			tabbyM.style.display = "block"; // tabby
			tailStripes.style.display = "block"; // tabby
		}
	
	
		faceSpotting.style.display = "block";

		if (spotting === "s_s") {
			faceSpotting.style.display = "none";
			panzetta.style.opacity = "0.1";
			panzettaBig.style.opacity = "0.0";
		}

		if (spotting === "S_s") {
			blaze.style.display = "block";
			chin.style.display = "block";
			blazeBig.style.display = "none";
			chinBig.style.display = "none";
			panzetta.style.opacity = "0.85";
			panzettaBig.style.opacity = "0.0";
		}

		if (spotting === "S_S") {
			blaze.style.display = "block";
			chin.style.display = "block";
			blazeBig.style.display = "block";
			chinBig.style.display = "block";
			panzetta.style.opacity = "1.0";
			panzettaBig.style.opacity = "0.85";
		}
	}
}

function setGradient(g, c1, c2) {
	g.children[0].setAttribute("stop-color", c1);
	g.children[1].setAttribute("stop-color", c2);
}

const eyeLeft = document.getElementById("eyeLeft");
const pupilLeft = document.getElementById("pupilLeft");
const eyeRight = document.getElementById("eyeRight");
const pupilRight = document.getElementById("pupilRight");
const tailGroup = document.getElementById("tailGroup");
const svgrect = document.getElementById("catSVG").getBoundingClientRect();

function setEyeColor(left, right) {
  let irisRand = f_redblack.value === "o_o" && Math.random() < 0.5 ? "irisNormal" : "irisOrange";
  const gradientIdLeft = left ? "irisSiamese" : irisRand;
  const gradientIdRight = right ? "irisSiamese" : irisRand;
  document.getElementById("eyeLeft").setAttribute("fill", `url(#${gradientIdLeft})`);
  document.getElementById("eyeRight").setAttribute("fill", `url(#${gradientIdRight})`);
}

// Funzione per far muovere una pupilla
function movePupil(pupil, eye, mouseX, mouseY, maxOffset=5) {
    const eyeRect = eye.getBoundingClientRect();
    const eyeCenterX = eyeRect.x + eyeRect.width/2;
    const eyeCenterY = eyeRect.y + eyeRect.height/2;

    let dx = mouseX - eyeCenterX;
    let dy = mouseY - eyeCenterY;

    // Limitare la pupilla all'interno dell'occhio
    const angle = Math.atan2(dy, dx);
    const distance = Math.min(maxOffset, Math.sqrt(dx*dx + dy*dy));

    const newX = parseFloat(eye.getAttribute("cx")) + distance * Math.cos(angle);
    const newY = parseFloat(eye.getAttribute("cy")) + distance * Math.sin(angle) / 2;

    pupil.setAttribute("cx", newX);
    pupil.setAttribute("cy", newY);
}

function moveTail(clientX, clientY) {
	const mouseX = clientX - svgrect.left;// coordinate SVG
	const mouseY = clientY - svgrect.top;// coordinate SVG
	const centerX = svgrect.width / 2;// centro del gatto (circa meta SVG)
	const centerY = svgrect.width / 2;// centro del gatto (circa meta SVG)
	
	let dx = mouseX - centerX;// distanza orizzontale dal centro
	dx = Math.max(-6, Math.min(6, dx / 100));// normalizza e limita a +/- 6px
	
	let dy = mouseY - centerY;
	dy = Math.max(-3, Math.min(3, dy / 100));// normalizza e limita a +/- 3px
	
	tailGroup.setAttribute( "transform", `translate(${dx}, ${dy})`);//applica trasformazione
}

//Evento mousemove sostituito da pointermove che intercetta sia mousemove che touchmove
document.addEventListener("pointermove", (e) => {
    movePupil(pupilLeft, eyeLeft, e.clientX, e.clientY);
    movePupil(pupilRight, eyeRight, e.clientX, e.clientY);	
	moveTail(e.clientX, e.clientY);
});


selects.forEach(s => s.addEventListener("change", updateRocky));
updateRocky();
</script>
		</body>
	</html>
